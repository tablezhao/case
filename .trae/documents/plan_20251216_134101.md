# 修复Favicon上传失败问题

## 问题分析

上传favicon时提示"mime type image/x-icon is not supported"，原因是Supabase存储桶`app-800go8thhcsh_logos`只允许以下MIME类型：
- `image/png`
- `image/jpeg`
- `image/svg+xml`

而ICO文件的MIME类型通常是`image/x-icon`或`image/vnd.microsoft.icon`，不在允许列表中，导致上传失败。

## 解决方案

修改Supabase存储桶配置，添加ICO文件的MIME类型到允许列表中。

## 实现步骤

### 1. 修改存储桶迁移文件

**文件**：`supabase/migrations/00023_fix_logo_bucket_creation.sql`
**修改**：在`allowed_mime_types`数组中添加`image/x-icon`和`image/vnd.microsoft.icon`

```sql
--- 1. 确保存储桶存在
INSERT INTO storage.buckets (id, name, public, file_size_limit, allowed_mime_types)
VALUES (
  'app-800go8thhcsh_logos',
  'app-800go8thhcsh_logos',
  true,
  2097152, -- 2MB
  ARRAY['image/png', 'image/jpeg', 'image/svg+xml', 'image/x-icon', 'image/vnd.microsoft.icon']::text[]
)
ON CONFLICT (id) DO UPDATE SET
  public = EXCLUDED.public,
  file_size_limit = EXCLUDED.file_size_limit,
  allowed_mime_types = EXCLUDED.allowed_mime_types;
```

### 2. 修改初始迁移文件（可选）

**文件**：`supabase/migrations/00014_create_site_settings_table.sql`
**修改**：在注释中添加ICO文件的MIME类型，保持文档一致性

### 3. 执行迁移

运行Supabase迁移命令，将修改应用到数据库：

```bash
supabase db push
```

## 预期效果

- 存储桶将允许上传`image/x-icon`和`image/vnd.microsoft.icon`类型的文件
- favicon上传功能将能够成功处理ICO文件
- 不会影响现有功能的正常使用

## 验证方法

1. 执行迁移后，尝试上传ICO格式的favicon文件
2. 验证上传成功，并且能够在浏览器中正常显示
3. 检查Supabase Storage中是否成功存储了ICO文件