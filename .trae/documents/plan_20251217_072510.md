# 趋势总览模块数据获取方案优化计划

## 问题分析

通过分析`getTrendOverview`函数的实现，发现以下关键问题：

1. **数据获取限制**：所有Supabase查询都没有处理1000条记录限制，超过1000条时只会返回前1000条
2. **统计偏差**：
   - 当月通报风险等级统计可能不准确
   - 本年通报高频时段统计可能遗漏数据
   - 高频通报部门统计可能不准确
   - 高频被通报平台统计可能遗漏数据
3. **多次数据库请求**：函数内包含多个独立的数据库请求，增加了网络开销

## 解决方案

参照通报排名模块的修复方案，采用Supabase RPC函数在服务器端进行统计：

1. **创建SQL函数**：在Supabase控制台创建`get_trend_overview`函数
2. **实现服务器端统计**：
   - 当月通报风险等级计算
   - 本年通报高频时段统计
   - 高频通报部门统计
   - 高频被通报平台统计
3. **修改前端函数**：更新`getTrendOverview`函数，调用RPC函数
4. **测试验证**：确保统计数据准确性

## 实施步骤

1. 退出计划模式
2. 在Supabase控制台创建`get_trend_overview`函数
3. 修改`getTrendOverview`函数，调用RPC函数
4. 运行TypeScript和ESLint检查
5. 启动开发服务器，验证修复结果
6. 编写测试用例
7. 运行测试，确保修复有效

## 预期效果

- 趋势总览模块数据统计准确
- 无数据遗漏或统计偏差
- 减少数据库请求次数
- 提高页面加载性能
- 数据误差率控制在可接受范围内