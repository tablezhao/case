# 趋势分析页面数据统计逻辑修复计划

## 修复内容

1. **修改`getDepartmentRanking`函数**
   - 将数据结构中的`totalApps`字段替换为`apps` Set集合
   - 修改数据初始化逻辑，使用Set集合存储唯一应用名称
   - 修改数据统计逻辑，将应用名称添加到Set中去重
   - 修改结果转换逻辑，使用`apps.size`作为应用数量

2. **修改`getDepartmentApplicationTrend`函数**
   - 将数据结构中的`count`字段替换为`apps` Set集合
   - 修改数据初始化逻辑，使用Set集合存储唯一应用名称
   - 修改数据统计逻辑，将应用名称添加到Set中去重
   - 修改结果转换逻辑，使用`apps.size`作为应用数量

## 实施步骤

1. 退出计划模式
2. 按照修复方案修改`src/db/api.ts`文件中的两个函数
3. 运行TypeScript编译检查：`npx tsc --noEmit`
4. 运行ESLint检查：`npm run lint`
5. 启动开发服务器：`npm run dev`
6. 验证修复结果

## 预期效果

- 趋势分析页面与监管部门页面的数据统计口径保持一致
- 应用数量统计准确，按应用名称去重
- 页面展示正常，无数据错位或计算错误
- 代码通过TypeScript和ESLint检查

## 验证方法

1. 代码验证：通过TypeScript和ESLint检查
2. 功能验证：访问趋势分析页面，检查数据展示是否正确
3. 数据验证：与监管部门页面的数据进行对比
4. 日志验证：查看浏览器控制台日志，确认无错误信息