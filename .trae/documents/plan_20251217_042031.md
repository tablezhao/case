## 首页监管部门分布模块重构计划

### 1. 重构目标

设计并实现国家级部门和省级部门两个独立的饼图组件，用于可视化展示各监管部门在全部数据周期内通报的案例统计信息。每个饼图需清晰呈现：
- 各监管部门的名称
- 对应的案例总数量
- 该部门案例数量占同级部门案例总数的百分比

### 2. 现有代码分析

#### 2.1 饼图组件
- **文件路径**: `src/components/charts/PieChart.tsx`
- **核心功能**: 使用ECharts实现的响应式饼图组件
- **主要特性**: 响应式布局、自动处理大量数据、悬停高亮效果、详细tooltip
- **数据格式**: 接收`{ name: string; count: number }[]`格式数据

#### 2.2 数据获取
- **文件路径**: `src/db/api.ts`
- **主要函数**: 
  - `getNationalDepartmentDistribution()`: 获取国家级部门分布数据
  - `getProvincialDepartmentDistribution()`: 获取省级部门分布数据

#### 2.3 页面集成
- **文件路径**: `src/pages/HomePage.tsx`
- **当前实现**: 使用Tabs组件实现国家级/省级部门数据切换

### 3. 重构方案

#### 3.1 组件设计

保留现有的`PieChart`组件，因为它已经具备了所需的核心功能。在`HomePage`组件中，将国家级部门和省级部门的饼图分别独立展示，使用网格布局实现并排或上下排列。

#### 3.2 数据处理

1. **确保数据准确性**: 验证API返回数据的准确性，确保案例数量统计正确
2. **优化数据加载**: 使用并行加载策略，同时获取国家级和省级部门数据
3. **添加数据总数计算**: 在页面组件中计算同级部门案例总数，用于百分比计算

#### 3.3 页面布局

1. **独立饼图展示**: 将国家级部门和省级部门的饼图分别独立展示，不再使用Tabs切换
2. **清晰的标题和说明**: 为每个饼图添加明确的标题和图例说明
3. **响应式布局**: 使用Tailwind CSS的网格布局，确保在不同屏幕尺寸下都能良好展示
4. **保持整体风格一致**: 与页面其他组件保持统一的设计风格

#### 3.4 交互优化

1. **悬停效果**: 保持现有的悬停高亮效果，显示详细信息
2. **图例管理**: 优化图例显示，确保重要部门的图例可见
3. **数据排序**: 按案例数量降序排序，便于比较各部门的通报频次

### 4. 实现步骤

1. **修改HomePage组件**: 
   - 将国家级部门和省级部门的饼图分别独立展示
   - 使用网格布局实现并排或上下排列
   - 为每个饼图添加明确的标题和图例说明

2. **优化数据加载**: 
   - 使用`Promise.all`并行加载国家级和省级部门数据
   - 添加数据加载状态和错误处理

3. **验证数据准确性**: 
   - 检查API返回数据的准确性
   - 验证百分比计算是否正确

4. **测试与优化**: 
   - 测试不同屏幕尺寸下的显示效果
   - 优化交互体验
   - 确保与整体页面风格一致

### 5. 预期效果

- 国家级部门和省级部门的饼图分别独立展示
- 每个饼图清晰呈现部门名称、案例数量和百分比
- 图表设计符合整体页面风格，交互友好
- 数据展示准确直观，提供必要的图例说明

### 6. 技术栈

- React 18 + TypeScript
- Tailwind CSS
- Shadcn UI
- ECharts

通过以上重构，我们将实现一个更加直观、易用的监管部门分布模块，便于用户同时查看国家级和省级部门的通报情况。