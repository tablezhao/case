# 修复监管部门分布数据显示异常问题

## 问题分析

经过代码分析，我发现监管部门分布数据显示异常可能的原因：

1. **部门ID匹配问题**：案例中的 `department_id` 与国家级部门表中的 `id` 可能不匹配
2. **部门名称匹配问题**：部门表中可能存在名称不匹配的情况
3. **数据类型问题**：`department_id` 可能存在数据类型不一致导致匹配失败

## 修复方案

### 1. 优化API函数逻辑

修改 `getNationalDepartmentDistribution` 和 `getProvincialDepartmentDistribution` 函数，确保部门ID匹配正确：

- 确保 `department_id` 比较时考虑数据类型转换
- 增加调试日志，便于排查问题
- 优化数据查询逻辑，减少数据库请求次数

### 2. 修复数据关联问题

检查并修复案例数据与部门数据的关联问题：

- 确保案例表中的 `department_id` 正确关联到部门表中的 `id`
- 处理可能的部门名称重复或不匹配情况

### 3. 增强数据验证

在API函数中增加数据验证：

- 验证返回数据的完整性
- 处理异常数据情况
- 确保所有部门都能正确显示

## 测试验证

1. **正常数据测试**：验证修复后正常数据显示
2. **边界值测试**：测试数据为0的情况
3. **异常数据测试**：测试部门ID不匹配的情况
4. **性能测试**：确保修复后性能不受影响

## 预期效果

- "工业和信息化部"和"公安部计算机信息系统安全产品质量监督检验中心"的数据能够正确显示
- 其他部门数据不受影响
- 系统性能保持稳定

## 修复步骤

1. 修改 `src/db/api.ts` 中的部门分布API函数
2. 增加调试日志和数据验证
3. 测试修复效果
4. 清理调试日志

通过以上修复，我们可以确保监管部门分布数据能够准确、正常地显示在饼图中。