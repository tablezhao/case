## 首页部门分布饼图数据统计逻辑重新设计

### 问题分析

1. **当前实现**：
   - 首页饼图使用 `getNationalDepartmentDistribution()` 和 `getProvincialDepartmentDistribution()` 函数
   - 统计逻辑：直接统计每个部门的案例数量，未进行去重处理
   - 数据源：直接从 `cases` 表中查询数据

2. **监管部门页面实现**：
   - 使用 `getNationalDepartmentsWithStats()` 和 `getProvincialDepartmentsWithStats()` 函数
   - 统计逻辑：
     - 通报频次：按自然日合并，每日只计1次（使用 `Set` 去重）
     - 相关应用数：按应用名称去重后的总数（使用 `Set` 去重）
   - 数据源：从 `cases` 表中查询数据，然后进行去重处理

3. **优化版API**：
   - `getDepartmentDistributionOptimized()` 函数，使用 Supabase RPC 函数 `get_department_distribution_stats`
   - 实现了缓存机制，提高性能

### 设计方案

1. **统一统计逻辑**：
   - 采用与监管部门页面一致的统计标准
   - 按自然日合并，每日只计1次通报频次
   - 按应用名称去重统计相关应用数

2. **数据来源**：
   - 使用优化版 API 函数 `getDepartmentDistributionOptimized()`
   - 或重新实现 `getNationalDepartmentDistribution()` 和 `getProvincialDepartmentDistribution()` 函数，采用与监管部门页面一致的统计逻辑

3. **实现步骤**：
   - 修改 `getNationalDepartmentDistribution()` 函数，采用去重统计逻辑
   - 修改 `getProvincialDepartmentDistribution()` 函数，采用去重统计逻辑
   - 更新 `HomePage` 组件，确保使用正确的统计数据
   - 测试验证，确保数据准确性和一致性

### 修复步骤

1. **修改 `getNationalDepartmentDistribution()` 函数**：
   - 实现与 `getNationalDepartmentsWithStats()` 一致的统计逻辑
   - 按自然日合并，每日只计1次通报频次
   - 修改文件：`src/db/api.ts`

2. **修改 `getProvincialDepartmentDistribution()` 函数**：
   - 实现与 `getProvincialDepartmentsWithStats()` 一致的统计逻辑
   - 按自然日合并，每日只计1次通报频次
   - 修改文件：`src/db/api.ts`

3. **更新 `HomePage` 组件**：
   - 确保使用正确的统计数据
   - 检查数据类型和格式是否匹配
   - 修改文件：`src/pages/HomePage.tsx`

4. **测试验证**：
   - 验证首页饼图数据与监管部门页面数据的一致性
   - 测试不同数据量下的性能
   - 验证缓存机制是否正常工作

### 预期效果

- 首页饼图数据与监管部门页面数据保持一致
- 统计逻辑统一，数据准确性提高
- 性能优化，响应速度提升
- 代码结构清晰，易于维护

### 修复文件

- `src/db/api.ts`：修改部门分布统计函数
- `src/pages/HomePage.tsx`：更新数据使用