## 首页部门分布饼图数据统计维度调整计划

### 问题分析

1. **当前实现**：
   - 国家级和省级部门分布饼图使用"通报频次"作为统计基准
   - 统计逻辑：按自然日合并，每日只计1次通报频次
   - 数据源：从 `cases` 表中查询 `report_date` 字段，然后按日期去重统计

2. **用户需求**：
   - 将统计维度修改为"通报的相关应用数量"
   - 确保图表标题、数据标签及图例说明与新的数据维度保持一致
   - 验证数据计算逻辑的准确性
   - 测试环境中确认饼图数据展示正确

3. **参考实现**：
   - `getNationalDepartmentsWithStats()` 和 `getProvincialDepartmentsWithStats()` 函数中已有相关应用数量的统计逻辑
   - 统计方法：从 `cases` 表中查询 `app_name` 字段，然后按应用名称去重统计

### 修复方案

1. **修改部门分布统计函数**：
   - 修改 `getNationalDepartmentDistribution()` 函数，将统计维度从"通报频次"改为"通报的相关应用数量"
   - 修改 `getProvincialDepartmentDistribution()` 函数，应用相同的修改
   - 参考 `getNationalDepartmentsWithStats()` 和 `getProvincialDepartmentsWithStats()` 函数中的相关应用数量统计逻辑

2. **修改统计逻辑**：
   - 从 `cases` 表中获取 `app_name` 字段
   - 使用 `Set` 去重，统计每个部门通报的相关应用数量
   - 返回按应用数量排序的数据

3. **修改图表标题和图例说明**：
   - 修改 `HomePage` 组件中饼图的标题和图例说明，确保与新的数据维度保持一致
   - 更新 tooltip 内容，反映新的统计维度

### 修复步骤

1. **修改 `getNationalDepartmentDistribution()` 函数**：
   - 将统计维度从"通报频次"改为"通报的相关应用数量"
   - 修改文件：`src/db/api.ts`

2. **修改 `getProvincialDepartmentDistribution()` 函数**：
   - 应用与国家级部门分布相同的修改
   - 修改文件：`src/db/api.ts`

3. **修改 `HomePage` 组件**：
   - 更新饼图的标题和图例说明，确保与新的数据维度保持一致
   - 修改文件：`src/pages/HomePage.tsx`

4. **测试验证**：
   - 运行 lint 和 TypeScript 类型检查
   - 启动开发服务器，在浏览器中查看修复效果
   - 验证数据计算逻辑的准确性
   - 检查图表标题、数据标签及图例说明是否与新的数据维度保持一致

### 预期效果

- 国家级和省级部门分布饼图使用"通报的相关应用数量"作为统计基准
- 图表标题、数据标签及图例说明与新的数据维度保持一致
- 数据计算逻辑准确，与监管部门页面的统计标准保持统一
- 饼图数据展示正确，无数据错位或计算错误情况

### 修复文件

- `src/db/api.ts`
- `src/pages/HomePage.tsx`