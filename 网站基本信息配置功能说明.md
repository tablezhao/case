# 网站基本信息配置功能说明

## 📋 功能概述

为系统管理员提供一个集中、易用的操作界面，用于维护网站在前台展示的通用基本信息，并确保前台能及时、准确地同步这些变更。

---

## 🎯 核心功能

### 1. 可管理的信息项

| 信息项 | 说明 | 必填 | 限制 |
|--------|------|------|------|
| **网站主标题** | 网站的全称或主要展示标题 | ✅ 是 | 最多200字符 |
| **网站备用名称/简称** | 网站的简短名称或用于特定场景的替代名称 | ❌ 否 | 最多100字符 |
| **网站Logo图片** | 代表网站品牌标识的主要图像 | ❌ 否 | PNG/JPG/SVG，最大2MB |

### 2. 文本信息管理

**网站主标题**：
- 清晰的文本输入框
- 实时字符计数（当前/最大）
- 必填字段验证
- 最大200字符限制

**网站备用名称/简称**：
- 清晰的文本输入框
- 实时字符计数（当前/最大）
- 可选字段
- 最大100字符限制

### 3. Logo图片管理

**上传功能**：
- 点击上传区域打开文件选择器
- 支持拖拽上传（未来可扩展）
- 实时预览当前Logo

**格式限制**：
- ✅ PNG格式
- ✅ JPG/JPEG格式
- ✅ SVG格式
- ❌ 其他格式不支持

**大小限制**：
- 最大文件大小：2MB
- 前端实时验证
- 超过限制显示错误提示

**尺寸建议**：
- 建议使用正方形图片
- 最小尺寸：200x200像素
- 系统会自动适配显示

**删除功能**：
- 点击预览图右上角的"×"按钮删除
- 删除后显示默认图标
- 保存时同步删除服务器文件

**更换功能**：
- 上传新Logo后点击"更换Logo"按钮
- 自动删除旧Logo
- 上传新Logo到服务器

---

## 🎨 界面设计

### 布局结构

```
┌─────────────────────────────────────────────────────────┐
│  [← 返回]  │  网站基本信息配置                          │
│             管理网站的标题、名称和Logo                   │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  ┌───────────────────────────────────────────────────┐  │
│  │  基本信息                                         │  │
│  │  配置网站的基本展示信息                           │  │
│  ├───────────────────────────────────────────────────┤  │
│  │                                                   │  │
│  │  网站主标题 *                                     │  │
│  │  ┌─────────────────────────────────────────────┐ │  │
│  │  │ 合规通                                      │ │  │
│  │  └─────────────────────────────────────────────┘ │  │
│  │  网站的全称或主要展示标题（当前：3/200）         │  │
│  │                                                   │  │
│  │  网站备用名称/简称                                │  │
│  │  ┌─────────────────────────────────────────────┐ │  │
│  │  │ App监管案例查询平台                         │ │  │
│  │  └─────────────────────────────────────────────┘ │  │
│  │  网站的简短名称（当前：12/100）                  │  │
│  │                                                   │  │
│  │  网站Logo图片                                     │  │
│  │  代表网站品牌标识的主要图像                       │  │
│  │                                                   │  │
│  │  ┌─────────────────┐                             │  │
│  │  │                 │  [×]                        │  │
│  │  │   [Logo预览]    │                             │  │
│  │  │                 │                             │  │
│  │  └─────────────────┘                             │  │
│  │                                                   │  │
│  │  [📤 更换Logo]                                    │  │
│  │                                                   │  │
│  │  ℹ️ 格式要求：支持 PNG、JPG、SVG 格式            │  │
│  │     大小限制：不超过 2MB                          │  │
│  │     尺寸建议：建议使用正方形图片，最小 200x200   │  │
│  │                                                   │  │
│  │  ─────────────────────────────────────────────── │  │
│  │                                                   │  │
│  │  [💾 保存更改]                                    │  │
│  │                                                   │  │
│  │  ✅ 修改后点击"保存更改"按钮，配置将立即同步      │  │
│  │                                                   │  │
│  └───────────────────────────────────────────────────┘  │
│                                                           │
└─────────────────────────────────────────────────────────┘
```

### 交互设计

**操作流程**：
1. 管理员修改信息
2. 点击"保存更改"按钮
3. 前端验证数据
4. 上传Logo（如有）
5. 更新数据库
6. 显示成功提示
7. 前台立即同步

**反馈机制**：
- ✅ **成功提示**：绿色Toast通知"保存成功"
- ❌ **错误提示**：红色Toast通知具体错误原因
- ⏳ **加载状态**：按钮显示"保存中..."或"上传中..."
- 📊 **实时计数**：字符数实时更新

---

## 🔧 技术实现

### 前端技术栈

- **框架**：React + TypeScript
- **UI组件**：shadcn/ui
- **样式**：Tailwind CSS
- **表单验证**：前端实时验证
- **文件上传**：原生File API
- **状态管理**：React Hooks

### 后端技术栈

- **数据库**：Supabase PostgreSQL
- **存储**：Supabase Storage
- **认证**：Supabase Auth
- **安全**：Row Level Security (RLS)

### 数据库设计

#### `site_settings` 表

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | uuid | 主键 | PRIMARY KEY |
| site_title | text | 网站主标题 | NOT NULL, 最大200字符 |
| site_subtitle | text | 网站备用名称 | 可选, 最大100字符 |
| logo_url | text | Logo图片URL | 可选 |
| created_at | timestamptz | 创建时间 | 默认now() |
| updated_at | timestamptz | 更新时间 | 自动更新 |

#### 存储桶配置

- **桶名**：`app-800go8thhcsh_logos`
- **访问权限**：公开读取
- **文件大小限制**：2MB
- **允许的MIME类型**：
  - `image/png`
  - `image/jpeg`
  - `image/svg+xml`

### 安全策略

**Row Level Security (RLS)**：
- ✅ 所有用户可读取配置（用于前台展示）
- ✅ 仅管理员可修改配置
- ✅ 仅管理员可上传/删除Logo

**数据验证**：
- 前端验证：文件类型、大小、字符长度
- 后端验证：数据库约束、RLS策略
- 双重保障确保数据安全

### API接口

#### 1. 获取网站配置

```typescript
GET /api/site-settings

Response:
{
  id: string;
  site_title: string;
  site_subtitle: string | null;
  logo_url: string | null;
  created_at: string;
  updated_at: string;
}
```

#### 2. 更新网站配置

```typescript
PUT /api/site-settings/:id

Request:
{
  site_title?: string;
  site_subtitle?: string | null;
  logo_url?: string | null;
}

Response:
{
  id: string;
  site_title: string;
  site_subtitle: string | null;
  logo_url: string | null;
  created_at: string;
  updated_at: string;
}
```

#### 3. 上传Logo

```typescript
POST /storage/logos

Request: FormData (file)

Response:
{
  publicUrl: string;
}
```

#### 4. 删除Logo

```typescript
DELETE /storage/logos/:filename

Response:
{
  success: boolean;
}
```

---

## 📱 前台同步机制

### 实时同步策略

1. **Header组件加载时**：
   - 自动调用`getSiteSettings()`
   - 获取最新配置
   - 更新显示

2. **配置更新后**：
   - 数据库立即更新
   - 前台下次加载时自动同步
   - 无需手动刷新

3. **缓存处理**：
   - 使用React State管理
   - 页面刷新时重新加载
   - 确保数据一致性

### 显示位置

**Header组件**：
- 桌面端：左上角Logo + 标题
- 移动端：汉堡菜单中Logo + 标题

**显示逻辑**：
```typescript
// 如果有自定义Logo，显示自定义Logo
{siteSettings?.logo_url ? (
  <img src={siteSettings.logo_url} alt={siteSettings.site_title} />
) : (
  // 否则显示默认图标
  <Shield className="w-5 h-5" />
)}

// 显示网站标题
<span>{siteSettings?.site_title || '合规通'}</span>
```

---

## 🚀 使用指南

### 访问路径

**管理后台** → **网站基本信息**

或直接访问：`/admin/site-settings`

### 操作步骤

#### 1. 修改网站标题

1. 在"网站主标题"输入框中输入新标题
2. 注意字符数限制（200字符）
3. 点击"保存更改"按钮

#### 2. 修改备用名称

1. 在"网站备用名称/简称"输入框中输入新名称
2. 注意字符数限制（100字符）
3. 可以留空
4. 点击"保存更改"按钮

#### 3. 上传Logo

**首次上传**：
1. 点击上传区域
2. 选择图片文件（PNG/JPG/SVG，最大2MB）
3. 预览图片
4. 点击"保存更改"按钮

**更换Logo**：
1. 点击"更换Logo"按钮
2. 选择新图片文件
3. 预览新图片
4. 点击"保存更改"按钮
5. 系统自动删除旧Logo

**删除Logo**：
1. 点击预览图右上角的"×"按钮
2. Logo预览消失
3. 点击"保存更改"按钮
4. 系统删除Logo文件

---

## ⚠️ 注意事项

### 文件上传

1. **格式限制**：
   - 只支持PNG、JPG、SVG格式
   - 其他格式会被拒绝

2. **大小限制**：
   - 最大2MB
   - 超过限制会显示错误提示

3. **尺寸建议**：
   - 建议使用正方形图片
   - 最小200x200像素
   - 过小的图片可能显示模糊

### 字符限制

1. **网站主标题**：
   - 必填字段
   - 最多200字符
   - 超过限制无法保存

2. **网站备用名称**：
   - 可选字段
   - 最多100字符
   - 超过限制无法保存

### 数据同步

1. **保存后立即生效**：
   - 点击"保存更改"后立即更新数据库
   - 前台下次加载时自动同步

2. **浏览器缓存**：
   - 如果前台未更新，尝试刷新页面（Ctrl+F5）
   - 清除浏览器缓存

3. **Logo更新**：
   - Logo文件名包含时间戳
   - 避免浏览器缓存问题

---

## 🔍 故障排查

### 问题1：保存失败

**可能原因**：
- 网络连接问题
- 权限不足（非管理员）
- 数据验证失败

**解决方法**：
1. 检查网络连接
2. 确认管理员权限
3. 检查字符长度限制
4. 查看错误提示信息

### 问题2：Logo上传失败

**可能原因**：
- 文件格式不支持
- 文件大小超过限制
- 网络连接问题

**解决方法**：
1. 确认文件格式（PNG/JPG/SVG）
2. 确认文件大小（最大2MB）
3. 检查网络连接
4. 尝试压缩图片后重新上传

### 问题3：前台未更新

**可能原因**：
- 浏览器缓存
- 页面未刷新

**解决方法**：
1. 刷新页面（Ctrl+F5 或 Cmd+Shift+R）
2. 清除浏览器缓存
3. 尝试使用无痕模式访问

### 问题4：Logo显示异常

**可能原因**：
- 图片尺寸不合适
- 图片格式问题
- 图片损坏

**解决方法**：
1. 使用正方形图片
2. 确保图片清晰度足够
3. 尝试转换图片格式
4. 重新上传图片

---

## 📊 功能特点

### 优势

1. **集中管理**：
   - 一个页面管理所有基本信息
   - 无需修改代码
   - 实时生效

2. **易于使用**：
   - 直观的界面设计
   - 清晰的操作提示
   - 实时反馈

3. **安全可靠**：
   - 权限控制（仅管理员）
   - 数据验证（前后端双重）
   - 文件安全（格式、大小限制）

4. **响应式设计**：
   - 桌面端优化
   - 移动端适配
   - 触摸友好

### 未来扩展

1. **Logo管理增强**：
   - 支持多个Logo（深色/浅色模式）
   - Logo历史记录
   - Logo模板库

2. **SEO优化**：
   - 网站描述
   - 关键词设置
   - 社交媒体元标签

3. **多语言支持**：
   - 多语言标题
   - 多语言描述
   - 语言切换

4. **品牌管理**：
   - 品牌色彩配置
   - 字体配置
   - 主题配置

---

## 📞 技术支持

如有任何问题或建议，请联系技术团队。

---

**文档版本**：v1.0  
**更新日期**：2025-12-08  
**适用版本**：合规通 v2.0+
