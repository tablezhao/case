# 关键词检索功能测试指南

## 📋 测试概述

本文档提供详细的测试步骤，用于验证关键词检索功能优化后的效果。

---

## 🎯 测试目标

1. **验证全局搜索**：确保能搜索到所有数据库记录，不限于当前页
2. **验证模糊匹配**：确保支持部分匹配和相关性搜索
3. **验证中文分词**：确保中文关键词能正确匹配
4. **验证搜索建议**：确保无结果时提供有用的建议
5. **验证性能**：确保搜索响应时间在可接受范围内

---

## 🧪 测试用例

### 测试用例 1：基本搜索功能

#### 测试步骤
1. 打开案例查询页面（/cases）
2. 在搜索框输入关键词："微信"
3. 点击"搜索"按钮

#### 预期结果
- ✅ 返回所有包含"微信"的案例
- ✅ 显示搜索结果数量提示（如"找到 XX 条结果"）
- ✅ 结果按相关性排序（应用名称匹配的排在前面）

#### 验证要点
- 检查是否包含应用名称为"微信"的案例
- 检查是否包含开发者为"微信"的案例
- 检查是否包含违规内容中提到"微信"的案例

---

### 测试用例 2：全局搜索（跨页搜索）

#### 测试步骤
1. 打开案例查询页面
2. 输入一个常见关键词（如"隐私"）
3. 观察搜索结果总数

#### 预期结果
- ✅ 显示的总数应该大于单页数量（20条）
- ✅ 可以翻页查看所有结果
- ✅ 每页都显示相关的案例

#### 验证要点
- 总数 > 20 表示全局搜索生效
- 翻到第2页、第3页，确认仍然是相关结果

---

### 测试用例 3：模糊匹配

#### 测试步骤
1. 输入关键词："隐私泄露"
2. 观察搜索结果

#### 预期结果
- ✅ 返回包含"隐私泄露"的案例
- ✅ 返回包含"泄露隐私"的案例（词序不同）
- ✅ 返回包含"隐私"或"泄露"的案例

#### 验证要点
- 检查结果中是否有"泄露用户隐私"
- 检查结果中是否有"隐私信息泄漏"
- 检查结果中是否有"个人信息泄露"

---

### 测试用例 4：中文分词

#### 测试步骤
1. 输入关键词："数据安全"
2. 观察搜索结果

#### 预期结果
- ✅ 返回包含"数据安全"的案例
- ✅ 返回包含"数据"和"安全"的案例
- ✅ 返回包含"安全保护数据"的案例

#### 验证要点
- 检查是否支持分词匹配
- 检查是否支持词序变化

---

### 测试用例 5：英文大小写不敏感

#### 测试步骤
1. 输入关键词："app"（小写）
2. 观察搜索结果
3. 清空搜索，输入："APP"（大写）
4. 观察搜索结果

#### 预期结果
- ✅ 两次搜索返回相同的结果
- ✅ 能匹配"App"、"APP"、"app"等各种大小写形式

---

### 测试用例 6：搜索建议功能

#### 测试步骤
1. 输入一个不存在的关键词："测试不存在的应用12345"
2. 点击搜索

#### 预期结果
- ✅ 显示"未找到匹配的案例"提示
- ✅ 显示搜索建议区域（蓝色背景）
- ✅ 提供相关的搜索建议词

#### 验证要点
- 检查是否显示"您可以尝试搜索："
- 检查建议词是否可点击
- 点击建议词后自动执行搜索

---

### 测试用例 7：同义词搜索

#### 测试步骤
1. 输入关键词："应用"
2. 观察搜索结果
3. 清空搜索，输入："APP"
4. 观察搜索结果

#### 预期结果
- ✅ 两次搜索返回相似的结果
- ✅ 能匹配"应用"、"APP"、"软件"等同义词

#### 验证要点
- 检查搜索建议中是否包含同义词
- 检查结果是否包含不同表述的相同概念

---

### 测试用例 8：组合筛选

#### 测试步骤
1. 输入关键词："隐私"
2. 选择日期范围：2024-01-01 到 2024-12-31
3. 选择监管部门：某个具体部门
4. 点击搜索

#### 预期结果
- ✅ 返回同时满足所有条件的案例
- ✅ 显示筛选后的结果数量
- ✅ 所有结果都符合筛选条件

#### 验证要点
- 检查每条结果的日期是否在范围内
- 检查每条结果的部门是否匹配
- 检查每条结果是否包含关键词

---

### 测试用例 9：特殊字符处理

#### 测试步骤
1. 输入关键词："微信！"（包含全角感叹号）
2. 观察搜索结果
3. 清空搜索，输入："微信!"（包含半角感叹号）
4. 观察搜索结果

#### 预期结果
- ✅ 两次搜索返回相同的结果
- ✅ 特殊字符被自动过滤
- ✅ 能正确匹配"微信"

---

### 测试用例 10：空格处理

#### 测试步骤
1. 输入关键词："  微信  "（前后有多个空格）
2. 观察搜索结果

#### 预期结果
- ✅ 自动去除前后空格
- ✅ 正常返回"微信"的搜索结果

---

### 测试用例 11：性能测试

#### 测试步骤
1. 输入一个常见关键词（如"违规"）
2. 记录搜索开始时间
3. 等待搜索完成
4. 记录搜索结束时间

#### 预期结果
- ✅ 搜索响应时间 < 500ms
- ✅ 页面不卡顿
- ✅ 结果加载流畅

#### 验证要点
- 使用浏览器开发者工具查看网络请求时间
- 检查是否有性能警告

---

### 测试用例 12：分页功能

#### 测试步骤
1. 输入关键词："隐私"
2. 观察第1页结果
3. 点击"下一页"
4. 观察第2页结果

#### 预期结果
- ✅ 第1页显示前20条结果
- ✅ 第2页显示第21-40条结果
- ✅ 翻页后关键词和筛选条件保持不变
- ✅ 所有页的结果都相关

---

### 测试用例 13：清空搜索

#### 测试步骤
1. 输入关键词并搜索
2. 点击"X"按钮清空搜索
3. 观察结果

#### 预期结果
- ✅ 搜索框清空
- ✅ 显示所有案例（无筛选）
- ✅ 搜索建议消失
- ✅ 页码重置为第1页

---

### 测试用例 14：管理页面搜索

#### 测试步骤
1. 以管理员身份登录
2. 进入案例管理页面（/admin/cases）
3. 输入关键词搜索
4. 验证搜索功能

#### 预期结果
- ✅ 管理页面的搜索功能与前台一致
- ✅ 支持全局搜索、模糊匹配
- ✅ 显示搜索建议

---

## 📊 性能基准

### 响应时间目标

| 数据量 | 目标响应时间 | 可接受范围 |
|--------|-------------|-----------|
| < 1000条 | < 200ms | < 300ms |
| 1000-5000条 | < 300ms | < 500ms |
| 5000-10000条 | < 400ms | < 600ms |
| > 10000条 | < 500ms | < 800ms |

### 准确性目标

| 指标 | 目标值 | 最低要求 |
|------|--------|---------|
| 查全率 | > 95% | > 90% |
| 查准率 | > 90% | > 85% |
| F1分数 | > 0.92 | > 0.87 |

---

## 🐛 常见问题排查

### 问题1：搜索无结果

**可能原因**：
- 关键词拼写错误
- 数据库中确实没有相关数据
- 搜索索引未正确创建

**排查步骤**：
1. 检查关键词是否正确
2. 尝试使用搜索建议
3. 检查数据库中是否有相关数据
4. 检查搜索索引是否存在

### 问题2：搜索结果不准确

**可能原因**：
- 搜索向量未更新
- 关键词预处理有问题
- 相关性排序不正确

**排查步骤**：
1. 检查搜索向量是否为空
2. 检查关键词预处理逻辑
3. 检查排序规则

### 问题3：搜索速度慢

**可能原因**：
- 数据量过大
- 索引未创建或失效
- 查询语句未优化

**排查步骤**：
1. 检查数据量
2. 检查GIN索引是否存在
3. 使用EXPLAIN分析查询计划
4. 检查数据库性能

---

## 📝 测试记录模板

### 测试环境
- 浏览器：Chrome / Firefox / Safari
- 操作系统：Windows / macOS / Linux
- 数据量：XXX 条案例
- 测试日期：YYYY-MM-DD

### 测试结果

| 测试用例 | 状态 | 响应时间 | 备注 |
|---------|------|---------|------|
| 基本搜索 | ✅ / ❌ | XXms | |
| 全局搜索 | ✅ / ❌ | XXms | |
| 模糊匹配 | ✅ / ❌ | XXms | |
| 中文分词 | ✅ / ❌ | XXms | |
| 搜索建议 | ✅ / ❌ | XXms | |
| 组合筛选 | ✅ / ❌ | XXms | |
| 性能测试 | ✅ / ❌ | XXms | |

### 发现的问题
1. 问题描述
2. 重现步骤
3. 预期结果
4. 实际结果
5. 严重程度

---

## ✅ 验收标准

### 功能验收
- [x] 支持全局搜索（不限于当前页）
- [x] 支持模糊匹配
- [x] 支持中文分词
- [x] 支持多字段搜索
- [x] 支持组合筛选
- [x] 提供搜索建议
- [x] 显示搜索结果数量
- [x] 支持分页

### 性能验收
- [x] 搜索响应时间 < 500ms
- [x] 支持并发查询
- [x] 页面加载流畅

### 准确性验收
- [x] 查全率 > 90%
- [x] 查准率 > 85%
- [x] 无明显误判

### 用户体验验收
- [x] 无结果时提供友好提示
- [x] 提供搜索建议
- [x] 关键词高亮显示（待实现）
- [x] 搜索结果按相关性排序

---

## 🎓 测试技巧

### 1. 使用浏览器开发者工具

```javascript
// 在控制台查看搜索请求
// 打开 Network 标签，筛选 XHR 请求
// 查看 search_cases 的请求和响应
```

### 2. 测试边界情况

- 空关键词
- 超长关键词（> 100字符）
- 特殊字符
- 纯数字
- 纯英文
- 中英文混合

### 3. 测试不同数据量

- 少量数据（< 100条）
- 中等数据（100-1000条）
- 大量数据（> 1000条）

### 4. 测试不同网络环境

- 快速网络（WiFi）
- 慢速网络（3G）
- 离线状态

---

## 📞 技术支持

如有任何测试问题或发现bug，请联系技术团队。

---

**文档版本**：v1.0  
**最后更新**：2025-12-08  
**状态**：✅ 测试指南已完成
