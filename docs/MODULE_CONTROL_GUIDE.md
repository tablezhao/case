# 模块可见性控制功能使用指南

## 📖 功能概述

模块可见性控制功能允许管理员通过后台管理界面，集中控制前台各功能模块的显示状态。当某个模块被关闭时，它将在前台完全隐藏，用户无法通过任何方式访问。

## 🎯 可控制的模块

系统支持以下5个模块的可见性控制：

| 模块名称 | 模块标识 | 影响范围 |
|---------|---------|---------|
| 案例查询模块 | cases | 导航菜单、首页、案例查询页面、案例详情页面 |
| 监管资讯模块 | news | 导航菜单、首页、资讯列表页面、资讯详情页面 |
| 监管部门模块 | departments | 导航菜单、监管部门页面 |
| 趋势分析模块 | trends | 首页趋势分析图表、趋势分析页面 |
| 问题分析模块 | issues | 首页问题分析词云 |

## 🔧 使用方法

### 访问模块设置页面

1. 使用管理员账号登录系统
2. 点击右上角用户菜单，选择"管理后台"
3. 在管理后台首页，点击"模块设置"卡片
4. 进入模块可见性控制页面

### 控制模块显示

1. 在模块设置页面，您会看到所有可控制模块的列表
2. 每个模块卡片显示：
   - 模块图标和名称
   - 模块描述
   - 当前状态（已启用/已关闭）
   - 开关按钮
3. 点击开关按钮即可切换模块状态
4. 状态变更会立即保存到数据库
5. 前台用户刷新页面后即可看到变化

## 📋 功能特性

### 1. 实时生效
- 开关状态修改后立即保存
- 无需手动点击"保存"按钮
- 操作成功后显示确认提示

### 2. 完全隐藏
关闭模块后，前台将发生以下变化：
- **导航菜单**：对应的导航链接完全消失
- **首页**：相关模块区域不再显示
- **直接访问**：用户输入URL直接访问时，会被重定向到首页
- **布局调整**：页面布局自动调整，不会出现空白区域

### 3. 用户友好
- 清晰的视觉反馈（启用/关闭状态）
- 操作提示和说明
- 响应式设计，支持各种屏幕尺寸

### 4. 扩展性强
- 基于数据库驱动
- 易于添加新的可控制模块
- 统一的控制逻辑

## 🛡️ 安全机制

### 权限控制
- 只有管理员可以访问模块设置页面
- 普通用户无法看到或修改模块设置

### 路由保护
- 关闭的模块页面无法通过URL直接访问
- 自动重定向到首页，避免404错误

### 数据一致性
- 使用数据库触发器自动更新时间戳
- 确保状态变更可追溯

## 💡 使用建议

### 最佳实践
1. **非高峰时段操作**：建议在访问量较低的时段进行模块调整
2. **谨慎关闭**：关闭前确认该功能确实不需要对外展示
3. **及时通知**：如果关闭重要模块，建议提前通知用户
4. **定期检查**：定期检查模块设置，确保符合业务需求

### 常见场景
- **功能维护**：临时关闭某个模块进行数据更新或功能维护
- **分阶段发布**：新功能开发完成后，先关闭，测试无误后再开启
- **季节性调整**：根据业务需求，在特定时期开启或关闭某些模块
- **简化界面**：对于不常用的功能，可以临时关闭以简化用户界面

## 🔍 技术实现

### 架构设计
```
数据库层 (module_settings表)
    ↓
API层 (getModuleSettings, updateModuleSetting)
    ↓
Context层 (ModuleContext)
    ↓
组件层 (Header, HomePage, Routes)
```

### 数据流
1. 应用启动时，ModuleContext 从数据库加载模块设置
2. 各组件通过 useModules() hook 获取模块状态
3. 根据模块状态决定是否渲染相关内容
4. 管理员修改设置时，立即更新数据库和Context状态

### 关键文件
- **数据库迁移**: `supabase/migrations/*_create_module_settings.sql`
- **类型定义**: `src/types/types.ts`
- **API函数**: `src/db/api.ts`
- **Context**: `src/contexts/ModuleContext.tsx`
- **后台页面**: `src/pages/admin/ModuleSettingsPage.tsx`
- **路由保护**: `src/components/common/ProtectedModuleRoute.tsx`

## 🐛 故障排查

### 问题：修改后前台没有变化
**解决方案**：
1. 确认修改已保存（查看成功提示）
2. 前台用户需要刷新页面
3. 检查浏览器缓存

### 问题：无法访问模块设置页面
**解决方案**：
1. 确认使用管理员账号登录
2. 检查用户角色是否为 'admin'
3. 清除浏览器缓存后重新登录

### 问题：开关无法切换
**解决方案**：
1. 检查网络连接
2. 查看浏览器控制台错误信息
3. 确认数据库连接正常

## 📞 技术支持

如遇到问题或需要添加新的可控制模块，请联系技术团队。

---

**版本**: 1.0.0  
**更新日期**: 2025-12-04
